#!/usr/bin/env node

var path = require('path');
var args = require('optimist').argv;

if (args.h || args.help) {
    console.log('Usage: ' + path.basename(args.$0) + ' [options] [[path] port]');
    console.log('  Serves via HTTP a file system directory');
    console.log('');
    console.log('options:');
    console.log('  -i          Show incoming headers');
    console.log('  -o          Show outgoing headers');
    console.log('  -h, --help  Show this help');
    console.log('');
    console.log('path:');
    console.log('  The directory to serve; defaults to the current directory');
    console.log('');
    console.log('port:');
    console.log('  The port on which to serve; defaults to port 80');
    console.log('');
    return;
}

var port = args._.pop();
var basePath = args._.pop();

require('../lib/server').serve({
    port: port,
    basePath: basePath,

    showIncomingHeaders: args.i,
    showOutgoingHeaders: args.o,

    callback: function (host, port, basePath) {
        console.log('Serving %s on port %d', basePath, port);
    },
    error: function (err) {
        console.error('ERROR: ' + err);

        if (err.code === 'EACCES') {
            console.error('(Did you mean to run sserve as root?)');
        }

        if (args._.length === 0) {
            console.log('Type `' + args.$0 + ' --help` for usage');
        }

        process.exit(1);
    }
});

// vim:syntax=javascript:
